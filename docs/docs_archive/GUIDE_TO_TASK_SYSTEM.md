# üìã –°–ò–°–¢–ï–ú–ê –°–û–ó–î–ê–ù–ò–Ø –ó–ê–î–ê–ß –ò–ó –ì–ê–ô–î–û–í

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞:
1. **–°–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á—É** –∏–∑ –≥–∞–π–¥–∞
2. **–ù–∞—Ö–æ–¥–∏—Ç –ø–æ–¥–∑–∞–¥–∞—á–∏** –≤ –ø–æ–ª–µ "–î–∏–∑–∞–π–Ω –ø–æ–¥–∑–∞–¥–∞—á–∏" –≥–∞–π–¥–∞
3. **–ö–æ–ø–∏—Ä—É–µ—Ç –ø–æ–¥–∑–∞–¥–∞—á–∏** –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –±–∞–∑–µ —á–µ–∫–ª–∏—Å—Ç–æ–≤
4. **–°–≤—è–∑—ã–≤–∞–µ—Ç** —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ —Å –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π

### –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞:
- ‚ùå –ù–ï —Å–æ–∑–¥–∞–µ—Ç —á–µ–∫–ª–∏—Å—Ç—ã –∏–∑ —Ç–µ–ª–∞ –≥–∞–π–¥–∞
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∏–∑ –±–∞–∑—ã —á–µ–∫–ª–∏—Å—Ç–æ–≤
- ‚ùå –ù–ï —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥–∑–∞–¥–∞—á–∏ –∫–∞–∫ –±–ª–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á–∏

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `final_correct_system.py` - –æ—Å–Ω–æ–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- `notion_mcp_server.py` - MCP —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

### –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
- **–ó–∞–¥–∞—á–∏**: `d09df250ce7e4e0d9fbe4e036d320def`
- **–ß–µ–∫–ª–∏—Å—Ç—ã**: `47c6086858d442ebaeceb4fad1b23ba3`
- **–ì–∞–π–¥—ã**: `47c60868-58d4-42eb-aece-b4fad1b23ba3`
- **–ü–æ–¥–∑–∞–¥–∞—á–∏**: `9c5f4269-d614-49b6-a748-5579a3c21da3`

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

```python
async def create_task_with_guide_subtasks(guide_id: str, task_title: str):
    # 1. –ü–æ–ª—É—á–∞–µ–º –≥–∞–π–¥
    guide = await client.pages.retrieve(page_id=guide_id)
    
    # 2. –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥–∑–∞–¥–∞—á–∏ –≤ –ø–æ–ª–µ "–î–∏–∑–∞–π–Ω –ø–æ–¥–∑–∞–¥–∞—á–∏"
    guide_subtasks = guide['properties'].get('–î–∏–∑–∞–π–Ω –ø–æ–¥–∑–∞–¥–∞—á–∏', {}).get('relation', [])
    
    # 3. –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –±–∞–∑—ã
    actual_subtasks = []
    for relation in guide_subtasks:
        subtask_obj = await client.pages.retrieve(page_id=relation['id'])
        if subtask_obj['parent']['database_id'] == "9c5f4269-d614-49b6-a748-5579a3c21da3":
            actual_subtasks.append(relation)
    
    # 4. –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á—É
    new_task = await client.pages.create(task_data)
    
    # 5. –ö–æ–ø–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é –ø–æ–¥–∑–∞–¥–∞—á—É
    for guide_subtask_relation in actual_subtasks:
        subtask_id = guide_subtask_relation['id']
        guide_subtask = await client.pages.retrieve(page_id=subtask_id)
        
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ –ø–æ–ª—è "–ü–æ–¥–∑–∞–¥–∞—á–∏"
        subtasks_prop = guide_subtask['properties'].get('–ü–æ–¥–∑–∞–¥–∞—á–∏', {})
        if subtasks_prop and subtasks_prop.get('type') == 'title':
            subtasks_array = subtasks_prop.get('title', [])
            subtask_title = subtasks_array[0].get('text', {}).get('content', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')
        else:
            subtask_title = f"–ü–æ–¥–∑–∞–¥–∞—á–∞ {subtask_id[:8]}"
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –ø–æ–¥–∑–∞–¥–∞—á–∏
        new_subtask = await client.pages.create(new_subtask_data)
```

## üìä –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•

### –ì–∞–π–¥:
- **–ü–æ–ª–µ**: "–î–∏–∑–∞–π–Ω –ø–æ–¥–∑–∞–¥–∞—á–∏" (relation)
- **–°–æ–¥–µ—Ä–∂–∏—Ç**: –°—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏ –≤ –±–∞–∑–µ –ø–æ–¥–∑–∞–¥–∞—á

### –ü–æ–¥–∑–∞–¥–∞—á–∞ –≤ –≥–∞–π–¥–µ:
- **–ë–∞–∑–∞**: `9c5f4269-d614-49b6-a748-5579a3c21da3`
- **–ü–æ–ª–µ**: "–ü–æ–¥–∑–∞–¥–∞—á–∏" (title) - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏
- **–ü–æ–ª–µ**: "–û–ø–∏—Å–∞–Ω–∏–µ" (rich_text) - –æ–ø–∏—Å–∞–Ω–∏–µ
- **–ü–æ–ª–µ**: " –°—Ç–∞—Ç—É—Å" (status) - —Å—Ç–∞—Ç—É—Å

### –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–∑–∞–¥–∞—á–∞:
- **–ë–∞–∑–∞**: –ß–µ–∫–ª–∏—Å—Ç—ã (`47c6086858d442ebaeceb4fad1b23ba3`)
- **–ü–æ–ª–µ**: "Name" (title) - –Ω–∞–∑–≤–∞–Ω–∏–µ
- **–ü–æ–ª–µ**: "–°—Ç–∞—Ç—É—Å" (status) - —Å—Ç–∞—Ç—É—Å "–°—Ç–∞—Ä—Ç"
- **–ü–æ–ª–µ**: "–î–∏–∑–∞–π–Ω –∑–∞–¥–∞—á–∏" (relation) - —Å–≤—è–∑—å —Å –∑–∞–¥–∞—á–µ–π

## üöÄ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### –ß–µ—Ä–µ–∑ Python:
```python
import asyncio
from final_correct_system import create_task_with_guide_subtasks

guide_id = "20face03-d9ff-8176-9357-ee1f5c52e5a5"
result = asyncio.run(create_task_with_guide_subtasks(
    guide_id=guide_id,
    task_title="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∏–∑ –≥–∞–π–¥–∞"
))
```

### –ß–µ—Ä–µ–∑ MCP —Å–µ—Ä–≤–µ—Ä:
```json
{
    "name": "create_task_from_guide_with_subtasks",
    "arguments": {
        "guide_id": "20face03-d9ff-8176-9357-ee1f5c52e5a5",
        "task_title": "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∏–∑ –≥–∞–π–¥–∞",
        "task_url": "https://example.com/task"
    }
}
```

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢

### –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –≤ –±–∞–∑–µ –∑–∞–¥–∞—á
- ‚úÖ –ó–∞–¥–∞—á–∞ —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –≥–∞–π–¥–æ–º
- ‚úÖ –ö–æ–ø–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∏–∑ –≥–∞–π–¥–∞
- ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —Å –∑–∞–¥–∞—á–µ–π

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```json
{
    "success": true,
    "task_id": "21dace03-d9ff-8191-bcb0-ce64de65980e",
    "task_url": "https://www.notion.so/dreamclub22/21dace03d9ff8191bcb0ce64de65980e",
    "guide_title": "üì¶ –ì–∞–π–¥: –£–ø–∞–∫–æ–≤–∫–∞",
    "copied_subtasks": [
        {"id": "...", "title": "–ù–æ–≤—ã–π –∫–∞–∫–æ–π —Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç 1"},
        {"id": "...", "title": "–ù–æ–≤—ã–π –∫–∞–∫–æ–π —Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç 2"},
        {"id": "...", "title": "–ù–æ–≤—ã–π –∫–∞–∫–æ–π —Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç 3"}
    ],
    "subtasks_count": 3,
    "message": "–ó–∞–¥–∞—á–∞ '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∏–∑ –≥–∞–π–¥–∞' —Å–æ–∑–¥–∞–Ω–∞ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ 3 –ø–æ–¥–∑–∞–¥–∞—á"
}
```

## üîç –û–¢–õ–ê–î–ö–ê

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:
```python
python final_correct_system.py
```

## üéØ –ü–†–ò–ú–ï–†–´

### –ì–∞–π–¥ "üì¶ –ì–∞–π–¥: –£–ø–∞–∫–æ–≤–∫–∞":
- **ID**: `20face03-d9ff-8176-9357-ee1f5c52e5a5`
- **–ü–æ–¥–∑–∞–¥–∞—á–∏**: 3 –ø–æ–¥–∑–∞–¥–∞—á–∏ –≤ –ø–æ–ª–µ "–î–∏–∑–∞–π–Ω –ø–æ–¥–∑–∞–¥–∞—á–∏"
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ —Å 3 —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–¥–∑–∞–¥–∞—á–∞–º–∏

## üìù –ó–ê–ú–ï–¢–ö–ò

1. **–ù–∞–∑–≤–∞–Ω–∏—è –ø–æ–¥–∑–∞–¥–∞—á**: –ë–µ—Ä—É—Ç—Å—è –∏–∑ –ø–æ–ª—è "–ü–æ–¥–∑–∞–¥–∞—á–∏" –ø–æ–¥–∑–∞–¥–∞—á–∏
2. **–°—Ç–∞—Ç—É—Å—ã**: –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ "–°—Ç–∞—Ä—Ç"
3. **–°–≤—è–∑–∏**: –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —Å –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π
4. **–û—Ä–∏–≥–∏–Ω–∞–ª—ã**: –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ –≤ –≥–∞–π–¥–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏
5. **–ö–æ–ø–∏–∏**: –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –±–∞–∑–µ —á–µ–∫–ª–∏—Å—Ç–æ–≤
6. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö 