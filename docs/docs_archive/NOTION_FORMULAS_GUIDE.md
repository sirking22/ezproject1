# üìã –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –§–û–†–ú–£–õ–ê–ú NOTION API

**–î–∞—Ç–∞**: 2025-01-18  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï–ú

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´

### ‚úÖ –ß—Ç–æ –†–ê–ë–û–¢–ê–ï–¢ —á–µ—Ä–µ–∑ API:
- **–ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—É–ª—ã**: —á–∏—Å–ª–∞, —Å—Ç—Ä–æ–∫–∏, –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **Relation –ø–æ–ª—è**: `prop('–ü–æ–ª–µ')`, `length(prop('–ü–æ–ª–µ'))`
- **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: `1 + 1`, `2 * 3`
- **–£—Å–ª–æ–≤–∏—è**: `if(—É—Å–ª–æ–≤–∏–µ, –¥–∞, –Ω–µ—Ç)`
- **–§—É–Ω–∫—Ü–∏–∏**: `now()`, `length('—Ç–µ–∫—Å—Ç')`

### ‚ùå –ß—Ç–æ –ù–ï –†–ê–ë–û–¢–ê–ï–¢ —á–µ—Ä–µ–∑ API:
- **–°–ª–æ–∂–Ω—ã–µ relation –æ–ø–µ—Ä–∞—Ü–∏–∏**: `filter()`, `map()`, `average()`, `sum()`
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–≤—è–∑–∞–Ω–Ω—ã–º –ø–æ–ª—è–º**: `current.prop('–°—Ç–∞—Ç—É—Å') == 'Done'`
- **–ê–≥—Ä–µ–≥–∞—Ü–∏—è relation –¥–∞–Ω–Ω—ã—Ö**: `.map().average()`

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:
```
‚Ä¢ 0 ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
‚Ä¢ "–¢–µ—Å—Ç" ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ  
‚Ä¢ if(1 == 1, 1, 0) ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
‚Ä¢ 1 + 1 ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
‚Ä¢ now() ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
‚Ä¢ length("test") ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
‚Ä¢ prop('–ü—Ä–æ–µ–∫—Ç—ã') ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
‚Ä¢ length(prop('–ü—Ä–æ–µ–∫—Ç—ã')) ‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ
```

### ‚ùå –ù–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã:
```
‚Ä¢ prop('–ü—Ä–æ–µ–∫—Ç—ã').length() ‚Üí ‚ùå Parse error
‚Ä¢ prop('–ü—Ä–æ–µ–∫—Ç—ã').filter(...) ‚Üí ‚ùå Parse error
‚Ä¢ prop('–ü—Ä–æ–µ–∫—Ç—ã').map(...) ‚Üí ‚ùå Parse error
‚Ä¢ prop('–ü—Ä–æ–µ–∫—Ç—ã').average() ‚Üí ‚ùå Parse error
```

---

## üîß –ü–†–ê–í–ò–õ–¨–ù–´–ô –°–ò–ù–¢–ê–ö–°–ò–°

### ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:
```javascript
// –ü—Ä–æ—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
0
"—Ç–µ–∫—Å—Ç"
true

// –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
1 + 1
2 * 3
10 / 2

// –£—Å–ª–æ–≤–∏—è
if(1 == 1, 1, 0)
if(prop('–°—Ç–∞—Ç—É—Å') == 'Done', '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–í —Ä–∞–±–æ—Ç–µ')

// –§—É–Ω–∫—Ü–∏–∏
now()
length("—Ç–µ–∫—Å—Ç")
format(123.45)

// Relation –ø–æ–ª—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)
prop('–ü—Ä–æ–µ–∫—Ç—ã')
length(prop('–ü—Ä–æ–µ–∫—Ç—ã'))
```

### ‚ùå –ù–ï —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:
```javascript
// –ú–µ—Ç–æ–¥—ã relation –ø–æ–ª–µ–π
prop('–ü—Ä–æ–µ–∫—Ç—ã').length()
prop('–ü—Ä–æ–µ–∫—Ç—ã').filter(...)
prop('–ü—Ä–æ–µ–∫—Ç—ã').map(...)
prop('–ü—Ä–æ–µ–∫—Ç—ã').average()

// –°–ª–æ–∂–Ω—ã–µ relation –æ–ø–µ—Ä–∞—Ü–∏–∏
prop('–ü—Ä–æ–µ–∫—Ç—ã').filter(current.prop('–°—Ç–∞—Ç—É—Å') == 'Done')
prop('–ü—Ä–æ–µ–∫—Ç—ã').map(current.prop('–ß–∞—Å—ã')).average()
```

---

## üéØ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –†–ï–®–ï–ù–ò–Ø

### 1. –ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—É–ª—ã —á–µ—Ä–µ–∑ API
```python
# ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
simple_formula = "0"
simple_formula = "if(prop('–°—Ç–∞—Ç—É—Å') == 'Done', 1, 0)"
simple_formula = "length(prop('–ü—Ä–æ–µ–∫—Ç—ã'))"

await client.databases.update(
    database_id=database_id,
    properties={
        "–ù–æ–≤–æ–µ –ø–æ–ª–µ": {
            "type": "formula",
            "formula": {"expression": simple_formula}
        }
    }
)
```

### 2. –°–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã –≤—Ä—É—á–Ω—É—é
```javascript
// –°–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é –≤ Notion UI
if(
  prop("–ü—Ä–æ–µ–∫—Ç—ã").filter(current.prop("–°—Ç–∞—Ç—É—Å") == "Done" or current.prop("–°—Ç–∞—Ç—É—Å") == "In Production").length() > 0,
  prop("–ü—Ä–æ–µ–∫—Ç—ã").filter(current.prop("–°—Ç–∞—Ç—É—Å") == "Done" or current.prop("–°—Ç–∞—Ç—É—Å") == "In Production").map(current.prop("–ß–∞—Å—ã")).average(),
  0
)
```

### 3. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
1. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–ª–µ —á–µ—Ä–µ–∑ API** —Å –±–∞–∑–æ–≤–æ–π —Ñ–æ—Ä–º—É–ª–æ–π
2. **–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É –≤—Ä—É—á–Ω—É—é** –≤ Notion UI –Ω–∞ —Å–ª–æ–∂–Ω—É—é –≤–µ—Ä—Å–∏—é
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å rollup –ø–æ–ª—è** –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üìã –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –†–ê–ó–ù–´–• –°–õ–£–ß–ê–ï–í

### –°–ª—É—á–∞–π 1: –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞
```python
# ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API
formula = "if(prop('–°—Ç–∞—Ç—É—Å') == 'Done', '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–í —Ä–∞–±–æ—Ç–µ')"
```

### –°–ª—É—á–∞–π 2: –ù—É–∂–Ω–∞ —Å–ª–æ–∂–Ω–∞—è relation —Ñ–æ—Ä–º—É–ª–∞
```python
# 1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–ª–µ —á–µ—Ä–µ–∑ API
simple_formula = "0"
await client.databases.update(...)

# 2. –ó–∞–º–µ–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É –≤—Ä—É—á–Ω—É—é –≤ Notion UI
complex_formula = """
if(
  prop("–ü—Ä–æ–µ–∫—Ç—ã").filter(current.prop("–°—Ç–∞—Ç—É—Å") == "Done").length() > 0,
  prop("–ü—Ä–æ–µ–∫—Ç—ã").filter(current.prop("–°—Ç–∞—Ç—É—Å") == "Done").map(current.prop("–ß–∞—Å—ã")).average(),
  0
)
"""
```

### –°–ª—É—á–∞–π 3: –ù—É–∂–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```python
# ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ rollup –ø–æ–ª—è –≤–º–µ—Å—Ç–æ —Ñ–æ—Ä–º—É–ª
rollup_property = {
    "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è": {
        "type": "rollup",
        "rollup": {
            "relation_property_name": "–ü—Ä–æ–µ–∫—Ç—ã",
            "rollup_property_name": "–ß–∞—Å—ã",
            "function": "average"
        }
    }
}
```

---

## üö® –û–®–ò–ë–ö–ò –ò –†–ï–®–ï–ù–ò–Ø

### –û—à–∏–±–∫–∞: "Parse error with formula"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
**–†–µ—à–µ–Ω–∏–µ**: 
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `length(prop('–ü–æ–ª–µ'))` –≤–º–µ—Å—Ç–æ `prop('–ü–æ–ª–µ').length()`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–≤—ã—á–∫–∏: `prop('–ü–æ–ª–µ')` –∏–ª–∏ `prop("–ü–æ–ª–µ")`

### –û—à–∏–±–∫–∞: "Type error with formula"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
**–†–µ—à–µ–Ω–∏–µ**:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–æ—Ä–º—É–ª—É –≤—Ä—É—á–Ω—É—é –≤ Notion UI

### –û—à–∏–±–∫–∞: "Relation field not found"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è
**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ relation –ø–æ–ª—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `prop('–¢–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ')`

---

## üîß MCP –°–ï–†–í–ï–†

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º—É–ª** —á–µ—Ä–µ–∑ API
2. **–°–æ–∑–¥–∞–Ω–∏–µ relation —Ñ–æ—Ä–º—É–ª** —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
4. **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```python
# –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞
await mcp.call_tool("notion_create_simple_formula", {
    "database_id": "db_id",
    "field_name": "–°—Ç–∞—Ç—É—Å —Ç–µ–∫—Å—Ç–æ–º",
    "formula": "if(prop('–°—Ç–∞—Ç—É—Å') == 'Done', '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–í —Ä–∞–±–æ—Ç–µ')"
})

# Relation —Ñ–æ—Ä–º—É–ª–∞
await mcp.call_tool("notion_create_relation_formula", {
    "database_id": "db_id", 
    "field_name": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–æ–≤",
    "relation_field": "–ü—Ä–æ–µ–∫—Ç—ã",
    "operation": "length"
})
```

---

## üìä –í–´–í–û–î–´

### ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
1. **–ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç** —á–µ—Ä–µ–∑ API
2. **Relation –ø–æ–ª—è —Ä–∞–±–æ—Ç–∞—é—Ç** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ (—Ç–æ–ª—å–∫–æ `prop()` –∏ `length()`)
3. **–°–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç** —á–µ—Ä–µ–∑ API
4. **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥** - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API** –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º—É–ª
2. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã** –≤—Ä—É—á–Ω—É—é –≤ Notion UI
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ rollup –ø–æ–ª—è** –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ñ–æ—Ä–º—É–ª—ã** –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º —Å–æ–∑–¥–∞–Ω–∏–µ–º
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** –¥–ª—è –∫–æ–º–∞–Ω–¥—ã

### üìù –°—Ç–∞—Ç—É—Å:
- ‚úÖ **–ü–æ–Ω–∏–º–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π**: –ü–æ–ª–Ω–æ–µ
- ‚úÖ **–†–∞–±–æ—á–∏–µ —Ä–µ—à–µ–Ω–∏—è**: –ù–∞–π–¥–µ–Ω—ã
- ‚úÖ **MCP —Å–µ—Ä–≤–µ—Ä**: –û–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –°–æ–∑–¥–∞–Ω–∞

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –§–ê–ô–õ–´

- `notion_mcp_server_updated.py` - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä
- `test_notion_formula_syntax.py` - –¢–µ—Å—Ç—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
- `docs/MISTAKES.md` - –û–±–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- `docs/FINAL_REPORT_2025_01_18.md` - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç 