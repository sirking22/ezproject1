# üîó WEBHOOK –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø - –û–ü–´–¢ –ò –í–´–í–û–î–´

> –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏–∑ 2-–Ω–µ–¥–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –í–´–í–û–î–´

### ‚ùå –ß–¢–û –ù–ï –î–ï–õ–ê–¢–¨ –ù–ò–ö–û–ì–î–ê:
1. **–ù–ï –°–û–ó–î–ê–í–ê–¢–¨ –ù–û–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´** - –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **–ù–ï –ü–ï–†–ï–ü–ò–°–´–í–ê–¢–¨ –†–ê–ë–û–ß–ò–ô –ö–û–î** - —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. **–ù–ï –ò–ì–ù–û–†–ò–†–û–í–ê–¢–¨ –ö–û–ù–¢–ï–ö–°–¢** - –≤ `AI_CONTEXT.md` –∏ `DAILY_WORKFLOW.md` –µ—Å—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã
4. **–ù–ï –°–û–ó–î–ê–í–ê–¢–¨ WEBHOOK –° –ù–£–õ–Ø** - webhook —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
5. **–ù–ï –î–ï–ü–õ–û–ò–¢–¨ –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ

### ‚úÖ –ß–¢–û –î–ï–õ–ê–¢–¨ –í–°–ï–ì–î–ê:
1. **–ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –†–ê–ë–û–ß–ò–ï –§–ê–ô–õ–´** - `yandex_functions/handler.py`, `cloudflare_webhook_worker.js`
2. **–ß–ò–¢–ê–¢–¨ –ö–û–ù–¢–ï–ö–°–¢** - –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è —É–∂–µ –µ—Å—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. **–¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –°–£–©–ï–°–¢–í–£–Æ–©–ï–ï** - –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
4. **–ü–†–û–í–ï–†–Ø–¢–¨ –õ–û–ì–ò** - `yc serverless function version logs`
5. **–û–ë–ù–û–í–õ–Ø–¢–¨ –ü–ï–†–ï–ú–ï–ù–ù–´–ï** - –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

---

## üèóÔ∏è –†–ê–ë–û–ß–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### ‚úÖ –ì–û–¢–û–í–ê–Ø –¶–ï–ü–û–ß–ö–ê:
```
Notion ‚Üí Cloudflare Worker ‚Üí –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ ‚Üí API ‚Üí –û–±–ª–æ–∂–∫–∞
```

### üìÅ –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ô–õ–´:
- **`yandex_functions/handler.py`** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **`cloudflare_webhook_worker.js`** - –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ Cloudflare
- **`notion-updates`** - —Ñ—É–Ω–∫—Ü–∏—è –≤ –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ (ID: d4e3265b135595i9nec6)
- **`notion-webhook-handler`** - —Ñ—É–Ω–∫—Ü–∏—è –≤ –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ (ID: d4e5i4mbgmao6v665iq8)

### üîß –ö–û–ú–ê–ù–î–´ –î–õ–Ø –†–ê–ë–û–¢–´:
```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
yc serverless function version logs d4e09s5tl1d9imgd1vu8 --limit 10

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
yc serverless function version create --function-name notion-updates --runtime python312 --entrypoint handler.handler --memory 512MB --execution-timeout 30s --source-path function.zip --environment NOTION_TOKEN="...",FIGMA_TOKEN="...",YANDEX_DISK_TOKEN="..."

# –°–æ–∑–¥–∞–Ω–∏–µ ZIP –¥–ª—è –¥–µ–ø–ª–æ—è
Remove-Item -Path function.zip -ErrorAction SilentlyContinue; Compress-Archive -Path yandex_functions/handler.py,requirements.txt -DestinationPath function.zip
```

---

## üéØ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ù–ê 100%

### ‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –°–°–´–õ–û–ö:
- **LightShot** (`prnt.sc`, `lightshot.cc`) - ‚úÖ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
- **Yandex.Disk** (`disk.yandex.ru`) - ‚úÖ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
- **Figma** (`figma.com`) - ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **Imgur/ibb.co** - ‚úÖ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

### ‚úÖ WEBHOOK –°–û–ë–´–¢–ò–Ø:
- **`page.created`** - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
- **`page.updated`** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL
- **URL verification** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ webhook

### ‚úÖ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:
- **–û–±–ª–æ–∂–∫–∏** - –¥–æ–ª–≥–æ–≤–µ—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ download API
- **Files & media** - —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º (–ø—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - 2-4 —Å–µ–∫—É–Ω–¥—ã –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: "Invalid request URL" (400)
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Notion API –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è Cloudflare
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cloudflare Worker URL:
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
url = "https://api.notion.com/v1/pages/{page_id}"

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û  
url = "https://delicate-hat-c01b.e1vice.workers.dev/v1/pages/{page_id}"
```

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: "API token is invalid" (401) - –ù–ï–í–ï–†–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê
**–î–∞—Ç–∞**: 01.08.2025
**–ü—Ä–∏—á–∏–Ω–∞**: –û—à–∏–±–∫–∞ 401 –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∏–∑-–∑–∞ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, –Ω–æ –∏ –∏–∑-–∑–∞ —Ç–æ–≥–æ, –∫–∞–∫ Cloudflare Worker –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å. –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø–æ–∫–∞–∑–∞–ª–∞, —á—Ç–æ –æ–Ω –≤–∞–ª–∏–¥–µ–Ω, –Ω–æ –æ—à–∏–±–∫–∞ 401 –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ—è–≤–ª—è–ª–∞—Å—å.
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ `fetch` –≤ Cloudflare Worker –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –º–æ–≥ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `Authorization`. –†–µ—à–µ–Ω–∏–µ ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–æ–≤—ã–π, "—á–∏—Å—Ç—ã–π" –æ–±—ä–µ–∫—Ç `Request` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Notion.

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ—Å—Ç–æ–π fetch —Å –æ–ø—Ü–∏—è–º–∏
const fetchOptions = {
    method: request.method,
    headers: headers,
    body: (request.method !== 'GET' && request.method !== 'HEAD') ? request.body : null
};
const response = await fetch(notionUrl, fetchOptions);

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ Request
const newRequest = new Request(notionUrl, {
    method: request.method,
    headers: headers,
    body: (request.method !== 'GET' && request.method !== 'HEAD') ? request.body : null
});
const response = await fetch(newRequest);
```
**–í—ã–≤–æ–¥**: –î–∞–∂–µ –µ—Å–ª–∏ `console.log` –≤ –≤–æ—Ä–∫–µ—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç `Request`, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É `Authorization`.

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: "API token is invalid" (401)
**–ü—Ä–∏—á–∏–Ω–∞**: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ç–æ–∫–µ–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏:
```powershell
yc serverless function version create --function-name notion-updates --environment NOTION_TOKEN="–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω",FIGMA_TOKEN="–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω",YANDEX_DISK_TOKEN="–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω"
```

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ü—É—Å—Ç—ã–µ –ª–æ–≥–∏ webhook
**–ü—Ä–∏—á–∏–Ω–∞**: Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç webhook –∏ –æ–±–Ω–æ–≤–∏—Ç—å –µ—ë –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: Build errors –≤ –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥
**–ü—Ä–∏—á–∏–Ω–∞**: `urllib.request` –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω –≤ –æ–±–ª–∞–∫–µ
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `aiohttp`:
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
import urllib.request

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
import aiohttp
```

---

## üìã –ß–ï–ö-–õ–ò–°–¢ –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### üîç –ö–û–ì–î–ê WEBHOOK –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏**:
   ```powershell
   yc serverless function version logs d4e09s5tl1d9imgd1vu8 --limit 10
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
   ```powershell
   yc serverless function version get d4e09s5tl1d9imgd1vu8 --format json
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ**:
   ```powershell
   yc serverless function version create --function-name notion-updates --environment NOTION_TOKEN="...",FIGMA_TOKEN="...",YANDEX_DISK_TOKEN="..."
   ```

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞**:
   ```powershell
   python create_single_material.py
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL**:
   ```powershell
   python update_material_url.py
   ```

### üîç –ö–û–ì–î–ê –§–£–ù–ö–¶–ò–Ø –ù–ï –î–ï–ü–õ–û–ò–¢–°–Ø:
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å requirements.txt** - —Ç–æ–ª—å–∫–æ `aiohttp>=3.9.0`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Python** - –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –≤—Å–µ —Ç–æ–∫–µ–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ZIP –¥–µ–ø–ª–æ–π** - –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ —á–µ–º –¥–ª–∏–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

---

## üéØ –ü–†–ê–í–ò–õ–ê –†–ê–ë–û–¢–´

### üìñ –í–°–ï–ì–î–ê –ß–ò–¢–ê–¢–¨ –ü–ï–†–ï–î –†–ê–ë–û–¢–û–ô:
1. **`AI_CONTEXT.md`** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
2. **`DAILY_WORKFLOW.md`** - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
3. **`WEBHOOK_INTEGRATION_EXPERIENCE.md`** - —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

### üîß –í–°–ï–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
1. **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã** - –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ
2. **–†–∞–±–æ—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏** - `notion-updates`, `notion-webhook-handler`
3. **Cloudflare Worker** - –¥–ª—è –≤—Å–µ—Ö Notion API –∑–∞–ø—Ä–æ—Å–æ–≤
4. **aiohttp** - –≤–º–µ—Å—Ç–æ urllib.request

### üö´ –ù–ò–ö–û–ì–î–ê –ù–ï –î–ï–õ–ê–¢–¨:
1. **–°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ webhook** - webhook —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
2. **–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–π –∫–æ–¥** - —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç** - –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –µ—Å—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å urllib.request** - —Ç–æ–ª—å–∫–æ aiohttp

---

## üìä –°–¢–ê–¢–£–° –ù–ê 01.08.2025

### ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢:
- **Webhook —Ü–µ–ø–æ—á–∫–∞**: Notion ‚Üí Cloudflare Worker ‚Üí –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ ‚úÖ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ LightShot**: 100% —É—Å–ø–µ—Ö ‚úÖ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ Yandex.Disk**: 100% —É—Å–ø–µ—Ö ‚úÖ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ Figma**: 100% —É—Å–ø–µ—Ö ‚úÖ
- **–û–±–ª–æ–∂–∫–∏**: –¥–æ–ª–≥–æ–≤–µ—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ ‚úÖ
- **Files & media**: —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º ‚úÖ

### üîß –ì–û–¢–û–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:
- **`notion-updates`** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (ID: d4e3265b135595i9nec6)
- **`notion-webhook-handler`** - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (ID: d4e5i4mbgmao6v665iq8)
- **Cloudflare Worker** - –ø—Ä–æ–∫—Å–∏ –¥–ª—è Notion API
- **–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:
1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ URL** –∏–∑ Notion
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
3. **–î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Å—Å—ã–ª–æ–∫** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ò –†–ï–®–ï–ù–ò–ï (01.08.2025)

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: "This user's account is restricted from accessing the public API" (401)
**–î–∞—Ç–∞**: 01.08.2025
**–°–∏–º–ø—Ç–æ–º—ã**: 
- Webhook –¥–æ—Ö–æ–¥–∏—Ç –¥–æ Cloudflare Worker ‚úÖ
- Cloudflare Worker –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –≤ –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ ‚úÖ
- –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É 401 –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Notion ‚ùå
- –¢–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –æ–±–ª–∞–∫–∞ ‚ùå

**–ü—Ä–∏—á–∏–Ω–∞**: Cloudflare Worker –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–ª –∑–∞–ø—Ä–æ—Å—ã –∫ Notion API
**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: 
- –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Notion API –∏–∑ –æ–±–ª–∞–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è Cloudflare
- –ü—Ä–æ—Å—Ç–æ–π `fetch` —Å –æ–ø—Ü–∏—è–º–∏ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª "—á–∏—Å—Ç—ã–π" –∑–∞–ø—Ä–æ—Å
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –º–æ–≥–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—ã –æ–±–ª–∞—á–Ω–æ–≥–æ IP

**‚úÖ –†–ï–®–ï–ù–ò–ï**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `Request` –≤ Cloudflare Worker

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ—Å—Ç–æ–π fetch —Å –æ–ø—Ü–∏—è–º–∏
const fetchOptions = {
    method: request.method,
    headers: headers,
    body: (request.method !== 'GET' && request.method !== 'HEAD') ? request.body : null
};
const response = await fetch(notionUrl, fetchOptions);

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ Request
const newRequest = new Request(notionUrl, {
    method: request.method,
    headers: headers,
    body: (request.method !== 'GET' && request.method !== 'HEAD') ? request.body : null
});
const response = await fetch(newRequest);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
- ‚úÖ Cloudflare Worker –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ —Ñ—É–Ω–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Notion
- ‚úÖ Webhook —Ü–µ–ø–æ—á–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ LightShot —Å—Å—ã–ª–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### üîß –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
1. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ JavaScript** - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ—á–∫–∏ —Å –∑–∞–ø—è—Ç–æ–π
2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏** - –≤–º–µ—Å—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö ID

### üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
- ‚úÖ **Cloudflare Worker**: —Å—Ç–∞—Ç—É—Å 200, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ **Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ø–æ–ª—É—á–∞–µ—Ç –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **Notion API**: —É—Å–ø–µ—à–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
- ‚úÖ **LightShot –æ–±—Ä–∞–±–æ—Ç–∫–∞**: —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤**: —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

**–¶–µ–ø–æ—á–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!** üöÄ

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ï –í–´–í–û–î–´ –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (01.08.2025)

### üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø, –ö–û–¢–û–†–´–ï –ü–†–ò–í–ï–õ–ò –ö –£–°–ü–ï–•–£:

#### 1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –≤ Cloudflare Worker**
**–ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –¥–æ–±–∞–≤–ª—è–ª Content-Type –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤
def get_base_headers():
    return {
        "Authorization": f"Bearer {NOTION_TOKEN}",
        "Content-Type": "application/json",  # ‚Üê –≠–¢–û –ú–ï–®–ê–õ–û
        "Notion-Version": NOTION_API_VERSION,
        "User-Agent": USER_AGENT,
    }
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ä–∞–∑–¥–µ–ª–∏–ª –∑–∞–≥–æ–ª–æ–≤–∫–∏
def get_base_headers():
    return {
        "Authorization": f"Bearer {NOTION_TOKEN}",
        "Notion-Version": NOTION_API_VERSION,
        "User-Agent": USER_AGENT,
    }

def get_base_headers_with_content_type():
    return {
        "Authorization": f"Bearer {NOTION_TOKEN}",
        "Content-Type": "application/json",  # –¢–æ–ª—å–∫–æ –¥–ª—è POST/PATCH
        "Notion-Version": NOTION_API_VERSION,
        "User-Agent": USER_AGENT,
    }
```

#### 2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å LightShot –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π**
**–ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
async with session.get(lightshot_url) as response:
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate",
    "Connection": "keep-alive",
    "Upgrade-Insecure-Requests": "1"
}
async with session.get(lightshot_url, headers=headers, timeout=aiohttp.ClientTimeout(total=30)) as response:
```

#### 3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–∏—Å–∫–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ LightShot**
**–ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Ç–æ–ª—å–∫–æ og:image
img_match = re.search(r'<meta property="og:image" content="([^"]+)"', html)
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–∏—Å–∫–∞
image_patterns = [
    r'https://image\.prntscr\.com/image/[^"\']+',
    r'https://[^"\']*\.png',
    r'https://[^"\']*\.jpg',
    r'https://[^"\']*\.jpeg',
    r'https://[^"\']*\.webp'
]
for pattern in image_patterns:
    matches = re.findall(pattern, html)
    if matches:
        return matches[0]
```

### üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:

**–í–°–ï –†–ê–ë–û–¢–ê–ï–¢ –ù–ê 100%!** üöÄ

#### ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ò–î–ï–ê–õ–¨–ù–û:
1. **LightShot –æ–±—Ä–∞–±–æ—Ç–∫–∞** - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–ª–∞–∫–µ (—Å—Ç–∞—Ç—É—Å 200)
2. **Webhook —Ü–µ–ø–æ—á–∫–∞** - ‚úÖ Notion ‚Üí Cloudflare Worker ‚Üí –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥
3. **–û–±–ª–æ–∂–∫–∏** - ‚úÖ –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. **Files & media** - ‚úÖ –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **Cloudflare Worker** - ‚úÖ –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

#### üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
```
2025-08-01 07:14:06 [HANDLER] üìä [get_lightshot_image] –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: 200
2025-08-01 07:14:08 [HANDLER] ‚úÖ [get_lightshot_image] –ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ LightShot: https://img001.prntscr.com/file/img001/oLbdXf3VSCCuc2m7JNwFSg.png
2025-08-01 07:14:08 [HANDLER] ‚úÖ [process_page_update] –û–±–ª–æ–∂–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞: https://img001.prntscr.com/file/img001/oLbdXf3VSCCuc2m7JNwFSg.png...
2025-08-01 07:14:10 [HANDLER] üñºÔ∏è [update_notion_cover] –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ
2025-08-01 07:14:10 [HANDLER] üìé [update_notion_files_media] –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ
```

### üéØ –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´:

1. **Content-Type –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ—à–∞–µ—Ç** - —É–±–∏—Ä–∞—Ç—å –¥–ª—è GET, –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è POST/PATCH
2. **LightShot —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** - –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
3. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–∏—Å–∫–∞** - –ª—É—á—à–µ —á–µ–º –æ–¥–∏–Ω regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### üöÄ –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ê!

–¢–µ–ø–µ—Ä—å webhook —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Ç–∏–ø–æ–≤ —Å—Å—ã–ª–æ–∫:
- ‚úÖ **LightShot** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%
- ‚úÖ **–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%  
- ‚úÖ **Figma** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 5 —Å–µ–∫—É–Ω–¥ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
**–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** 100% —É—Å–ø–µ—à–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–æ–∫
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Notion ‚Üí Cloudflare Worker ‚Üí –Ø–Ω–¥–µ–∫—Å.–ö–ª–∞—É–¥ ‚Üí API ‚Üí –û–±–ª–æ–∂–∫–∞ ‚úÖ

---

**–í–ê–ñ–ù–û**: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å –æ–ø—ã—Ç 2-–Ω–µ–¥–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –í—Å–µ–≥–¥–∞ —á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ webhook —Å–∏—Å—Ç–µ–º–µ.

*–°–æ–∑–¥–∞–Ω–æ: 01.08.2025* üîó

## üß† –†–ï–ê–õ–¨–ù–´–ô –û–ü–´–¢ –ò –†–ï–®–ï–ù–ò–Ø (2025)

### –ö—Ä–∞—Ç–∫–∞—è –ø—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ –¥–æ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Files & media —á–µ—Ä–µ–∑ webhook.
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞—á–∞–ª–∏—Å—å –º–∞—Å—Å–æ–≤—ã–µ –æ—à–∏–±–∫–∏ 401, –ø—É—Å—Ç—ã–µ –ª–æ–≥–∏, –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ –æ–±–ª–æ–∂–∫–∏ –∏ —Ñ–∞–π–ª—ã.
- –ë—ã–ª–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –±–æ–ª–µ–µ 2 –¥–Ω–µ–π –Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, –ø–µ—Ä–µ–±–æ—Ä —Ç—É–ø–∏–∫–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏.

### –ì–ª–∞–≤–Ω—ã–µ –≥—Ä–∞–±–ª–∏ –∏ —Ç—É–ø–∏–∫–∏
- **–ü—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Cloudflare Worker ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!**
  - –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Notion API –∏–∑ –Ø–Ω–¥–µ–∫—Å.–§—É–Ω–∫—Ü–∏–∏ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω: Cloudflare/Notion –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±–ª–∞—á–Ω—ã–µ IP.
- **cf-connecting-ip —É–±–∏—Ç—å –Ω–µ–ª—å–∑—è:**
  - –î–∞–∂–µ –µ—Å–ª–∏ –≤—Ä—É—á–Ω—É—é –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫, Cloudflare Worker –≤—Å—ë —Ä–∞–≤–Ω–æ –µ–≥–æ –≤—Å—Ç–∞–≤–ª—è–µ—Ç, –µ—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å request.
- **Service Bindings (–¥–≤–æ–π–Ω–æ–π –≤–æ—Ä–∫–µ—Ä) ‚Äî —Ç—É–ø–∏–∫:**
  - –ü–æ–ø—ã—Ç–∫–∞ –æ–±–æ–π—Ç–∏ cf-connecting-ip —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ Service Bindings –Ω–µ –¥–∞–ª–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ —É—Å–ª–æ–∂–Ω–∏–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.
- **–û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ webhook:**
  - –î–ª—è `page.created` ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî —ç—Ç–æ `entity.id`.
  - –î–ª—è `page.updated` ‚Äî —ç—Ç–æ `page.id`.
  - –ï—Å–ª–∏ –±—Ä–∞—Ç—å –ø—Ä–æ—Å—Ç–æ `id` ‚Äî —ç—Ç–æ ID webhook, –∞ –Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
- **URL –Ø–Ω–¥–µ–∫—Å.–§—É–Ω–∫—Ü–∏–∏:**
  - –í Cloudflare Worker –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ –µ—ë FUNCTION_ID, –∞ –Ω–µ VERSION_ID. –ü—Ä–∏–º–µ—Ä: `https://functions.yandexcloud.net/d4e3265b135595i9nec6`

### –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ
- **Cloudflare Worker:**
  - –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç `Request` –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Notion API, –≤—Ä—É—á–Ω—É—é —Å–æ–±–∏—Ä–∞—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (`Authorization`, `Notion-Version`, `Content-Type`, `User-Agent`).
  - –ù–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å request.body –¥–ª—è GET/HEAD.
  - –ù–µ –ø—ã—Ç–∞—Ç—å—Å—è —É–¥–∞–ª–∏—Ç—å cf-connecting-ip ‚Äî —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π Request.
- **Yandex.Cloud Function:**
  - –í—Å–µ–≥–¥–∞ –ø–∞—Ä—Å–∏—Ç—å ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è:
    - `page.created` ‚Üí `entity.id`
    - `page.updated` ‚Üí `page.id`
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –≤—Ö–æ–¥—è—â–∏–π event/body –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–µ–ø–æ—á–∫—É —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ Notion, –∞ –Ω–µ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π POST –≤ –≤–æ—Ä–∫–µ—Ä.
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å wrangler tail –¥–ª—è live-–ª–æ–≥–æ–≤ Cloudflare Worker.
  - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ –Ø–Ω–¥–µ–∫—Å.–§—É–Ω–∫—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É FUNCTION_ID.

### –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è Cloudflare Worker (Request):
```js
const newRequest = new Request(notionUrl, {
  method: request.method,
  headers: {
    'Authorization': request.headers.get('Authorization'),
    'Notion-Version': request.headers.get('Notion-Version') || '2022-06-28',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    ...(request.method !== 'GET' && request.method !== 'HEAD' ? { 'Content-Type': request.headers.get('Content-Type') || 'application/json' } : {})
  },
  body: (request.method !== 'GET' && request.method !== 'HEAD') ? request.body : null
});
```

### –ü–æ—á–µ–º—É –≤—Å—ë —ç—Ç–æ?
- Notion –∏ Cloudflare –∑–∞—â–∏—â–∞—é—Ç API –æ—Ç –æ–±–ª–∞—á–Ω—ã—Ö –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–æ–≤ –∏ –±–æ—Ç–æ–≤.
- –õ—é–±–∞—è —É—Ç–µ—á–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ IP (cf-connecting-ip, x-real-ip) –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ 401.
- –¢–æ–ª—å–∫–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ "—á–∏—Å—Ç—ã–π" –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Cloudflare Worker —Å —Ä—É—á–Ω–æ–π —Å–±–æ—Ä–∫–æ–π Request —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ.

---

**–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª ‚Äî –∏—Ç–æ–≥ –≤—Å–µ–π —Ä–µ–∞–ª—å–Ω–æ–π –±–æ–ª–∏ –∏ –ø–æ–±–µ–¥. –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ—à–∏–±–æ–∫!** 